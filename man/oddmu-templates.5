.\" Generated by scdoc 1.11.3
.\" Complete documentation for this program is not available as a GNU info page
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.nh
.ad l
.\" Begin generated content:
.TH "ODDMU-TEMPLATES" "5" "2024-03-14" "File Formats Manual"
.PP
.SH NAME
.PP
oddmu-templates - how to write the templates
.PP
.SH SYNOPSIS
.PP
These files act as HTML templates: \fIadd.\&html\fR, \fIdiff.\&html\fR, \fIedit.\&html\fR,
\fIfeed.\&html\fR, \fIsearch.\&html\fR, \fIstatic.\&html\fR, \fIupload.\&html\fR and \fIview.\&html\fR.\& They
contain special placeholders in double bracers {{like this}}.\&
.PP
.SH DESCRIPTION
.PP
Each template receives an object and uses the object'\&s properties to replace the
placeholders.\&
.PP
.PD 0
.IP \(bu 4
\fIadd.\&html\fR uses a \fIpage\fR
.IP \(bu 4
\fIdiff.\&html\fR uses a \fIpage\fR
.IP \(bu 4
\fIedit.\&html\fR uses a \fIpage\fR
.IP \(bu 4
\fIfeed.\&html\fR uses a \fIfeed\fR
.IP \(bu 4
\fIsearch.\&html\fR uses a \fIsearch\fR
.IP \(bu 4
\fIstatic.\&html\fR uses a \fIpage\fR
.IP \(bu 4
\fIupload.\&html\fR uses an \fIupload\fR
.IP \(bu 4
\fIview.\&html\fR uses a \fIpage\fR
.PD
.PP
.SS Page
.PP
A page has the following properties:
.PP
\fI{{.\&Title}}\fR is the page title.\& If the page doesn'\&t provide its own title, the
page name is used.\&
.PP
\fI{{.\&Name}}\fR is the page name, escaped for use in URLs.\& More specifically, it is
percent-escaped except for the slashes.\& The page name doesn'\&t include the \fI.\&md\fR
extension.\&
.PP
\fI{{.\&Dir}}\fR is the page directory, percent-escaped except for the slashes.\&
.PP
\fI{{.\&Base}}\fR is the basename of the current file (without the directory and
without the \fI.\&md\fR extension), escaped for use in URLs.\&
.PP
\fI{{.\&Language}}\fR is the suspected language of the page.\& This is used to set the
language on the \fIview.\&html\fR template.\& See "Non-English hyphenation" below.\&
.PP
\fI{{.\&Body}}\fR is the raw byte content of the page.\& Use \fI{{printf "%s" .\&Body}}\fR to
get the Markdown, as a string.\& This is used for the text area of the \fIedit.\&html\fR
template.\&
.PP
\fI{{.\&Hashtags}}\fR is an array of strings.\&
.PP
\fI{{.\&Html}}\fR contains some sort of HTML that depends on the template used.\&
.PP
.PD 0
.IP \(bu 4
For \fIview.\&html\fR, it is the rendered Markdown, as HTML.\&
.IP \(bu 4
For \fIsearch.\&html\fR, it is a page summary, with bold matches, as HTML.\&
.IP \(bu 4
For \fIfeed.\&html\fR, it is the escaped (!\&) HTML of the feed item.\&
.PD
.PP
\fI{{.\&Score}}\fR is a numerical score.\& It is only computed for \fIsearch.\&html\fR.\&
.PP
\fI{{.\&IsBlog}}\fR says whether the current page has a name starting with an ISO
date.\&
.PP
\fI{{.\&Today}}\fR is the current date, in ISO format.\& This is useful for "new page"
like links or forms (see \fBEXAMPLE\fR below).\&
.PP
\fI{{.\&Diff}}\fR is the page diff for \fIdiff.\&html\fR.\& It is only computed on demand so
it can be used in other templates, too.\& It probably doesn'\&t make much sense to
do so, however.\&
.PP
.SS Feed
.PP
The feed contains an item for the head of the feed and an array of items.\&
.PP
\fI{{.\&Items}}\fR is the array of feed items.\& To refer to them, you need to use a
\fI{{range .\&Items}}\fR … \fI{{end}}\fR construct.\&
.PP
If page A links to pages B and C, the head of the feed is based on page A and
the list of items contains B and C.\&
.PP
An item is a page plus a date.\& All the properties of a page can be used (see
\fBPage\fR above).\&
.PP
\fI{{.\&Date}}\fR is the date of the last update to the page, in RFC 822 format.\&
.PP
.SS Search
.PP
\fI{{.\&Query}}\fR is the query string.\&
.PP
\fI{{.\&Dir}}\fR is the directory in which the search starts, percent-escaped except
for the slashes.\&
.PP
\fI{{.\&Items}}\fR is an array of pages (see \fBPage\fR above).\& To refer to them, you need
to use a \fI{{range .\&Items}}\fR … \fI{{end}}\fR construct.\&
.PP
\fI{{.\&Previous}}\fR, \fI{{.\&Page}}\fR and \fI{{.\&Next}}\fR are the previous, current and next
page number in the results since doing arithmetics in templates is hard.\& The
first page number is 1.\& The last page is expensive to dermine and so that is not
available.\&
.PP
\fI{{.\&More}}\fR indicates if there are any more search results.\&
.PP
\fI{{.\&Results}}\fR indicates if there were any search results at all.\&
.PP
.SS Upload
.PP
\fI{{.\&Dir}}\fR is the directory where the uploaded file ends up, based on the URL
path, percent-escaped except for the slashes.\&
.PP
\fI{{.\&Name}}\fR is the \fIfilename\fR query parameter.\&
.PP
\fI{{.\&Last}}\fR is the filename of the last image uploaded.\&
.PP
\fI{{.\&Image}}\fR is a boolean to indicate whether the last file uploaded has a file
name indicating an image or not (such as ending in \fI.\&jpg\fR).\& If so, a thumbnail
can be shown by the template, for example.\&
.PP
\fI{{.\&MaxWidth}}\fR is the \fImaxwidth\fR query parameter, i.\&e.\& the value used for the
previous image uploaded.\&
.PP
\fI{{.\&Quality}}\fR is the \fIquality\fR query parameter, i.\&e.\& the value used for the
previous image uploaded.\&
.PP
\fI{{.\&Today}}\fR is the current date, in ISO format.\&
.PP
.SS Non-English hyphenation
.PP
Automatic hyphenation by the browser requires two things: The style sheet must
indicate "hyphen: auto" for an HTML element such as "body", and that element
must have a "lang" set (usually a two letter language code such as "de" for
German).\&
.PP
Oddmu attempts to detect the correct language for each page.\& It assumes that
languages are not mixed on the same page.\& If you know that you'\&re only going to
use a small number of languages – or just a single language!\& – you can set the
environment variable ODDMU_LANGUAGES to a comma-separated list of ISO 639-1
codes, e.\&g.\& "en" or "en,de,fr,pt".\&
.PP
"view.\&html" is used the template to render a single page and so the language
detected is added to the "html" element.\&
.PP
"search.\&html" is the template used to render search results and so "en" is used
for the "html" element and the language detected for every page in the search
result is added to the "article" element for each snippet.\&
.PP
"edit.\&html" and "add.\&html" are the templates used to edit a page and at that
point, the language isn'\&t known, so "en" is used for the "html" element and no
language is used for the "textarea" element.\&
.PP
.SH EXAMPLE
.PP
The following link in a template takes people to today'\&s page.\& If no such page
exists, they are redirected to the edit form where it can be created.\&
.PP
.nf
.RS 4
<a href="/view/{{\&.Today}}" accesskey="t">Today</a>
.fi
.RE
.PP
The following form allows people to edit the suggested page name.\&
.PP
.nf
.RS 4
<form role="new" action="/edit/{{\&.Dir}}" method="GET">
  <label for="id">New page:</label>
  <input id="id" type="text" spellcheck="false" name="id"
	  accesskey="g" value="{{\&.Today}}" required>
  <button>Edit</button>
</form>
.fi
.RE
.PP
The following puts the current date into the text area if and only if the page
itself is a blog page.\& Useful for \fIadd.\&html\fR:
.PP
.nf
.RS 4
<textarea name="body" rows="20" cols="80" placeholder="Text" lang=""
	  autofocus required>{{- if \&.IsBlog}}**{{\&.Today}}**\&. {{end}}</textarea>
.fi
.RE
.PP
.SH NOTES
.PP
The templates are always used as-is, irrespective of the current directory.\&
Therefore, a link to a specific page must be \fIabsolute\fR or it'\&ll point to a
different page depending on the current directory.\&
.PP
Consider the link to "/view/index".\& No matter what page a visitor is looking,
this takes visitors to the top "index" page.\& If the link points to "index"
instead, it takes a visitor to the "index" page of the current directory.\& In
this case, a visitor looking at "/view/projects/wiki" following a link to
"index" ends up on "/view/projects/index", not on "/view/index".\&
.PP
It'\&s up to you to decide what'\&s best for your site, of course.\&
.PP
If you want a link on \fIupload.\&html\fR to point to the current directory'\&s "index"
page, you need to use "/view/{{.\&Dir}}index" because if you link to "index" the
result points to "/upload/{{.\&Dir}}index".\&
.PP
Templates can be changed by uploading new copies of the template files.\&
.PP
Subdirectories can have their own copies of template files.\& One example use for
this is that they can point to a different CSS file.\&
.PP
.SH SEE ALSO
.PP
\fIoddmu\fR(1)
.PP
"Structuring the web with HTML"
https://developer.\&mozilla.\&org/en-US/docs/Learn/HTML
.PP
"Learn to style HTML using CSS"
https://developer.\&mozilla.\&org/en-US/docs/Learn/CSS
.PP
The "text/template" library explains how to write templates from a programmer
perspective.\& https://pkg.\&go.\&dev/text/template
.PP
The "html/template" library explains how the templates are made more secure in a
HTML context.\& https://pkg.\&go.\&dev/html/template
.PP
"Lingua" is the library used to detect languages.\&
https://github.\&com/pemistahl/lingua-go
.PP
.SH AUTHORS
.PP
Maintained by Alex Schroeder <alex@gnu.\&org>.\&
