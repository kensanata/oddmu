<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width">
    <title>Upload File</title>
    <style>
html { max-width: 70ch; padding: 2ch; margin: auto; color: #111; background-color: #ffe; }
body { hyphens: auto; }
form, textarea { width: 100%; }
label { display: inline-block; width: 20ch }
.last { max-width: 20% }
    </style>
    <script type="text/javascript">
var pasteImage = {
  init: function() {
    let e = document.getElementById('form');
    if (e)
      e.addEventListener('paste', pasteImage.handler);
  },
  handler: function(e) {
    if (e.clipboardData.files.length) {
      pasteImage.post(e.clipboardData.files);
    }
  },
  post: function(files) {
    let action = document.getElementById('form').getAttribute('action');
    var fd = new FormData();
    fd.append("name", document.getElementById('name').value);
    fd.append("maxwidth", document.getElementById('maxwidth').value);
    fd.append("quality", document.getElementById('quality').value);
    for (var i = 0; i < files.length; i++) {
      fd.append("file", files[i]);
    }
    try {
      fetch(action, { method: "POST", body: fd }).then((r) => window.location = r.url);
    } catch (e) {
      alert(e);
    }
  },
};
window.addEventListener('load', pasteImage.init);
</script>
  </head>
  <body lang="en">
    <h1>Upload Files</h1>
    {{if ne .Last ""}}
    <p>Previous upload: <a href="/view/{{.Dir}}{{.Last}}">{{.Last}}</a>
    {{if .Image}}
    <p><img class="last" src="/view/{{.Dir}}{{.Last}}"><br>
      <tt>Link: ![]({{.Last}})</tt>
    {{else}}
    <p>Link: <tt>[text]({{.Last}})</tt>
    {{end}}
    {{end}}
    <form id="form" action="/drop/{{.Dir}}" method="POST" enctype="multipart/form-data">
      <p>When uploading pictures from a phone, its filename is going to be something cryptic like IMG_1234.JPG.
        Please provide your own filename. End the base name with "-1" to auto-increment.
        Use <tt>.jpg</tt> or <tt>.png</tt> as the extension if you want to resize the picture.
      <p><label for="name">Filename to use:</label>
        <input id="name" name="name" value="{{.Name}}" type="text" placeholder="image-1.jpg" autofocus required>
      <p>If the uploaded file is a picture from a phone, it is going to be too big for your site.
        Sadly, resizing only works when uploading <tt>.jpeg</tt>, <tt>.webp</tt>, <tt>.heic</tt> and <tt>.png</tt> files.
        Feel free to specify a max width of 1200 pixels, for example.
      <p><label for="maxwidth">Max width:</label>
        <input id="maxwidth" name="maxwidth" value="{{.MaxWidth}}" type="number" min="10" placeholder="1200">
      <p>If the filename you provided above ends in <tt>.jpg</tt>, you can specify a quality.
        Typically, a quality of 60 is not too bad and a quality of 90 is more than enough.
      <p><label for="quality">Quality:</label>
        <input id="quality" name="quality" value="{{.Quality}}" type="number" min="1" max="99" placeholder="75">
      <p>Finally, pick the files or photos to upload.
        Picture metadata is only removed if the pictures gets resized.
        Providing a new max width is recommended for all pictures.
      <p>To delete a file, upload an empty file.
      <p><label for="file">Pick files to upload:</label>
        <input type="file" name="file" required multiple>
      <p><input type="submit" value="Save">
        <a href="/view/index"><button type="button">Cancel</button></a></p>
    </form>
  </body>
</html>
